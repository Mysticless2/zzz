	--                                                           --
	--	 _______ ___ ___ _______ ______ _______ ______ _______   --
	--	|   _   |   |   |   _   |      |       |   __ \    ___|  --
	--	|       |   |   |       |   ---|   -   |      <    ___|  --
	--	|___|___|\_____/|___|___|______|_______|___|__|_______|  --
	--	                                                         --
	--                      by Avallex                           --
	
	local Client = {}
	 
	--[[ GAME SERVICES ]]--
	local Players = game:GetService('Players')
	local ReplicatedStorage = game:GetService('ReplicatedStorage')
	local UserInputService = game:GetService('UserInputService')
	local Debris = game:GetService('Debris')
	local TweenService = game:GetService('TweenService')
	local RunService = game:GetService('RunService')
	
	--[[ NETWORK ]]--
	local NetworkFolder = ReplicatedStorage:WaitForChild('firearmsNetwork')
	local Modules = ReplicatedStorage:WaitForChild('firearmsModules')
	local RE,RF = NetworkFolder:WaitForChild('RE'),NetworkFolder:WaitForChild('RF')
	
	--[[ MODULE VARIABLES ]]--
	Client.FirearmFunctions = {}
	Client.Tool = script.Parent.Parent
	Client.Player = Players.LocalPlayer
	Client.Character = Client.Player.Character
	Client.Firingmode = 'AUTOMATIC'
	Client.IgnoreModel = workspace:WaitForChild('IgnoreModel')
	Client.Camera = workspace.CurrentCamera
	Client.Mouse = Client.Player:GetMouse()
	--
	repeat wait() Client.Character = Client.Player.Character until (Client.Character and Client.Character.Parent == workspace) or Client.Player.Parent ~= Players
	Client.Humanoid = Client.Character:WaitForChild('Humanoid',3)
	--
	repeat wait() until Client.Character.Parent == workspace or Client.Player.Parent ~= Players
	if not Client.Humanoid then warn('Humanoid not found.') return; end
	
	--[[ FIREARM STATS ]]--
	Client.firearmStats = require(Modules:WaitForChild('firearmStats'))[Client.Tool.Name]
	Client.AnimationIds = Client.firearmStats['AnimationIds']
	Client.Controls = Client.firearmStats['Controls']
	
	--[[ CLIENT SETUP ]]--
	Client.Status = {
		Equipped = false;
		Patrolling = false;
		Reloading = false;
		mouseDown = false;
		mouseRotate = true;
		--
		isFireable = true;
		isShooting = false;
		isJumping = false;
		isWalking = false;
		isRotating = false;
		isZoomed = false;
		isBoltAction = Client.firearmStats.Boltaction;
		isOnMobile = UserInputService.TouchEnabled;
		--
		hasScope = Client.firearmStats.hasScope;
		canFullauto = Client.firearmStats.Fullauto;
		--
		Ammunition = Client.firearmStats.MagCapacity;
		maxAmmunition = Client.firearmStats.MaxAmmo;
	}

	Client.firearmStats.IgnoreList[#Client.firearmStats.IgnoreList+1] = Client.Character
	
	--[[ ANIMATION HANDLING ]]--
	Client.AnimationTracks = {}
	for animName,animId in pairs(Client.AnimationIds) do
		local newAnimation = Instance.new('Animation',Client.Tool:WaitForChild('Handle'))
		newAnimation.Name = animName
		newAnimation.AnimationId = animId
		Client.AnimationTracks[animName] = Client.Humanoid:LoadAnimation(newAnimation)
	end
	
	--[[ AMMO CACHE HANDLING ]]--
	local AmmoCaches = workspace:FindFirstChild('AmmoCaches')
	if AmmoCaches then
		for i,cachePart in pairs(AmmoCaches:GetChildren()) do
			local cacheDebounce = false
			cachePart.Touched:connect(function(hitPart)
				pcall(function()
					local player = Players:GetPlayerFromCharacter(hitPart.Parent) or Players:GetPlayerFromCharacter(hitPart.Parent.Parent)
					if player and not cacheDebounce then
						cacheDebounce = true
						if Client.Status.Equipped then
							if Client.Status.maxAmmunition < Client.firearmStats.MaxAmmo then
								Client.Status.maxAmmunition = Client.firearmStats.MaxAmmo
								if Client.GUI and Client.GUI:FindFirstChild('Ammo') then Client.GUI.Ammo.Text = Client.Status.Ammunition..'/'..Client.Status.maxAmmunition end
								local newSound = cachePart.collectAmmo:Clone()
								newSound.Parent = cachePart
								newSound:Play()
								newSound.Ended:connect(function() newSound:Destroy() end)
							end
						end
						wait(.5)
						cacheDebounce = false
					end
				end)
				cacheDebounce = false
			end)
		end
	end
	
	--[[ SCOPE CAMERA CFRAME CALCULATION ]]--
	local function EulerAnglesYX(cameraCFrame)
		local _,_,_,m00,m01,m02,m10,m11,m12,m20,m21,m22 = CFrame.new().components(cameraCFrame)
		return math.abs(m12) > 0.99999 and -math.atan2(-m20,m00) or -math.atan2(-m02,m22),-math.asin(m12)
	end
	local newCFrameY,newCFrameX=EulerAnglesYX(Client.Camera.CFrame)
	
	
	local zoomToggle = false
	--[[ ZOOM IN ]]--
	function zoomIn()
		Client.Status.mouseRotate = false
		if Client.GUI and Client.Status.hasScope then
			if Client.GUI:FindFirstChild('Bar') then Client.GUI.Bar.Visible = false end
			if Client.GUI:FindFirstChild('Reticle') then Client.GUI.Reticle.Visible = true end
			if Client.GUI:FindFirstChild('Cursor') then Client.GUI.Cursor.Visible = false end
			game:GetService('StarterGui'):SetCoreGuiEnabled(Enum.CoreGuiType.All, false)
			game:GetService('StarterGui'):SetCoreGuiEnabled(Enum.CoreGuiType.Health, true)
		end
		Client.Status.isZoomed = true
		Client.Player.CameraMode = Enum.CameraMode.LockFirstPerson
		Client.Camera.CameraSubject = Client.Tool.AimPart2
		if Client.Status.hasScope then
			for i=1,((70 - Client.firearmStats.targetFOV) / 5) do
				Client.Camera.FieldOfView = Client.Camera.FieldOfView - 5
				wait(0.01)
			end
		end
	end
	
	--[[ ZOOM OUT ]]--
	function zoomOut()
		if Client.Status.hasScope then
			for i=1,((70 - Client.firearmStats.targetFOV) / 5)/2 do
				Client.Camera.FieldOfView = Client.Camera.FieldOfView + 5
				wait(0.01)
			end
		end
		Client.Camera.FieldOfView = 70
		Client.Player.CameraMode = Enum.CameraMode.Classic
		Client.Camera.CameraSubject = Client.Humanoid
		Client.Status.mouseRotate = true
		if Client.GUI and Client.Status.hasScope then
			if Client.GUI:FindFirstChild('Bar') then Client.GUI.Bar.Visible = true end
			if Client.GUI:FindFirstChild('Reticle') then Client.GUI.Reticle.Visible = false end
			if Client.GUI:FindFirstChild('Cursor') then Client.GUI.Cursor.Visible = true end
			game:GetService('StarterGui'):SetCoreGuiEnabled(Enum.CoreGuiType.All, true)
		end
		Client.Status.isZoomed = false
		zoomToggle = false
	end
	
	--[[ ZOOM TOGGLE ]]--
	function toggleZoom()
		if not zoomToggle then
			zoomToggle = true
			zoomIn()
		else
			zoomOut()
			zoomToggle = false
		end
	end
	
	--[[ UPDATE ZOOM POSITION ]]--
	coroutine.resume(coroutine.create(function()
		while wait(.5) do
			if not Client.Status.isZoomed then
				newCFrameY,newCFrameX=EulerAnglesYX(Client.Camera.CFrame)
			end
		end
	end))
	
	--[[ CLIENT EFFECTS ]]--
	function newMagazine()
		
		--[[ BOLT FIXING ]]--
		Client.Tool.BoltBack.Transparency = 0
		Client.Tool.Bolt.Transparency = 1
			
		--[[ ANIMATION ]]--
		Client.AnimationTracks['Reload']:Play()
		
		--[[ MAGAZINE CLONING ]]--
		local oldMagazine = Client.Tool:FindFirstChild('Mag')
		local newMagazine = oldMagazine:Clone()
		wait(Client.firearmStats.Waittimes.MagazineRelease)
		
		--[[ REMOVING OLD WELDS ]]--
		if oldMagazine:FindFirstChild('qCFrameWeldThingy') then oldMagazine:FindFirstChild('qCFrameWeldThingy'):Destroy() end
		Client.Tool.Handle.MagOut:Play()
		
		--[[ RE-PARENTING OLD MAG ]]--
		oldMagazine.Parent = Client.IgnoreModel
		oldMagazine.CanCollide = true
		Debris:AddItem(oldMagazine,1)
		wait(Client.firearmStats.Waittimes.ReloadTime)
		if not Client.Status.Equipped then
			newMagazine.Parent = Client.Tool
		else
			--[[ PARENTING NEW MAG ]]--
			newMagazine.Parent = Client.Tool
			Client.Tool.Handle.MagIn:Play()
			wait(Client.firearmStats.Waittimes.PrimeAfterReloadTime)
		end
	end
	--
	function roundFired()
		
		--[[ BOLT BACKWARDS ]]--
		if Client.Status.isBoltAction then wait(.1) end
		Client.Tool.BoltBack.Transparency = 0
		Client.Tool.Bolt.Transparency = 1
		
		--[[ SHELL EJECTION ]]--
		local shell = Instance.new("Part")
		shell.Material = Enum.Material.Metal
		shell.CFrame = Client.Tool.Chamber.CFrame * CFrame.fromEulerAnglesXYZ(1.5,0,0)
		shell.Size = Vector3.new(1,1,1)
		shell.Color = Color3.fromRGB(253, 139, 0)
		shell.Parent = Client.IgnoreModel
		shell.CFrame = Client.Tool.Chamber.CFrame
		shell.CanCollide = false
		shell.Transparency = 0
		shell.Reflectance = 0.4
		shell.BottomSurface = 0
		shell.TopSurface = 0
		shell.Name = "Shell"
		shell.Velocity = Client.Tool.Chamber.CFrame.lookVector * 35 + Vector3.new(math.random(-5,5),20,math.random(-5,10))
		shell.RotVelocity = Vector3.new(0,200,0)
		local oldProperties = PhysicalProperties.new(shell.Material)
		shell.CustomPhysicalProperties = PhysicalProperties.new(oldProperties.Density,oldProperties.Friction,0,oldProperties.FrictionWeight,0)
		Debris:AddItem(shell, 1)
	
		local shellmesh = Instance.new("SpecialMesh")
		shellmesh.Scale = Client.firearmStats.ShellSize
		shellmesh.Parent = shell
		wait(Client.firearmStats.Firerate)
		
		--[[ BOLT FORWARDS ]]--
		if Client.Status.Ammunition > 0 then
			if Client.Status.isBoltAction then wait(1) end
			Client.Tool.BoltBack.Transparency = 1
			Client.Tool.Bolt.Transparency = 0
		end
		
	end
	
		
	--[[ CURSOR UPDATE ]]--
	function cursorUpdate()
		if Client.Mouse.Target and Client.Mouse.Target.Parent:FindFirstChild('Humanoid') then
			local Player = game:GetService('Players'):GetPlayerFromCharacter(Client.Mouse.Target.Parent)
			if Player then
				if Player.Team == Client.Player.Team then
					Client.GUI.Cursor.ImageColor3 = Color3.fromRGB(0,200,0)
				elseif Player.Team == 'Civilians' then
					Client.GUI.Cursor.ImageColor3 = Color3.fromRGB(213,115,61)
				else
					Client.GUI.Cursor.ImageColor3 = Color3.fromRGB(200,0,0)
				end
			end
		else
			Client.GUI.Cursor.ImageColor3 = Color3.new(1,1,1)
		end
	end
	
	--[[ SETUP FUNCTIONS TO BE DISCONNECTED AFTER UNEQUIPPING ]]--
	function bootFirearm()
		
		--[[ JUMP FUNCTION ]]--
		Client.FirearmFunctions[#Client.FirearmFunctions+1] = Client.Humanoid.Jumping:connect(function()
			Client.Status.isJumping = true
			wait(.5)
			Client.Status.isJumping = false
		end)
		
		local goal = CFrame.new()
		
		--[[ RENDER STEPPED ]]--
		Client.FirearmFunctions[#Client.FirearmFunctions+1] = RunService.RenderStepped:connect(function()
			if Client.Status.Equipped then
	
				--[[ WALK & HOLD ANIMATION RUNNER ]]--
				if Client.Humanoid.MoveDirection == Vector3.new(0,0,0) and not Client.Status.Patrolling and Client.Status.isWalking then
					Client.AnimationTracks['Walk']:Stop()
					Client.Status.isWalking = false
				elseif Client.Status.isJumping then
					Client.AnimationTracks['Walk']:Stop()
					Client.Status.isWalking = false
				elseif Client.Humanoid.MoveDirection ~= Vector3.new(0,0,0) and not Client.Status.Patrolling and not Client.Status.isWalking and Client.Status.Equipped then
					Client.AnimationTracks['Walk']:Play(.2)
					Client.Status.isWalking = true
				end
				
				--[[ CURSOR POS ]]--
				if Client.GUI and Client.GUI:FindFirstChild('Cursor') then
					Client.GUI.Cursor.Position = UDim2.new(0,Client.Mouse.X-(Client.GUI.Cursor.AbsoluteSize.X/2),0,Client.Mouse.Y-(Client.GUI.Cursor.AbsoluteSize.Y/2))
					Client.Mouse.Icon = "http://www.roblox.com/asset/?id=131719387"
					cursorUpdate()
				end
		
				--[[ CHECK SPEED ]]--
				if Client.Status.isWalking and not Client.Status.Patrolling then Client.Humanoid.WalkSpeed = 12 elseif not Client.Status.Patrolling then Client.Humanoid.WalkSpeed = 16 end
				
				--[[ ZOOM CAMERA ]]--
				if Client.Mouse and Client.Status.isZoomed then
					local currentCFrameY,currentCFrameX=EulerAnglesYX(Client.Camera.CFrame)
					newCFrameY,newCFrameX=newCFrameY*(1-.15)+(currentCFrameY+(2*math.pi)*math.floor((newCFrameY-currentCFrameY)/(2*math.pi)+0.5))*.15,newCFrameX*(1-.15)+(currentCFrameX+(2*math.pi)*math.floor((newCFrameX-currentCFrameX)/(2*math.pi)+0.5))*.15
					Client.Camera.CFrame=CFrame.Angles(0,newCFrameY,0)*CFrame.Angles(newCFrameX,0,0)*CFrame.new(0,0,0.5)+Client.Camera.Focus.p
				end				
				
				local Part = Client.Character:FindFirstChild('HumanoidRootPart')
				--[[ FACE MOUSE ]]--
			    if Client.Mouse and Part and (Client.firearmStats.FollowCursor or Client.Status.isZoomed) then
				    Client.Humanoid.AutoRotate = false
				    local newTween = TweenService:Create(Part, TweenInfo.new(Client.firearmStats.Waittimes.cursorSpeed, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
					      CFrame = CFrame.new(Part.Position, Client.Mouse.Hit.p * Vector3.new(1, 0, 1) + Part.Position * Vector3.new(0, 1, 0))
				    })
				    newTween:Play()
			    else
				    if not Client.firearmStats.FollowCursor and not Client.Status.isZoomed then
					Client.Humanoid.AutoRotate = true
				    else
					-- MOBILE FACE TOUCH
				    end
				end
			end
		end)
	end
	
	--[[ PATROL HANDLING ]]--
	function lowerWeapon()
		if not Client.Status.Patrolling then
			Client.AnimationTracks['Hold']:Stop()
			Client.AnimationTracks['Patrol']:Play()
			Client.AnimationTracks['Walk']:Stop()
			Client.Status.isWalking = false
			Client.Status.Patrolling = true
			Client.Humanoid.WalkSpeed = Client.firearmStats.Speeds.Runspeed
		else
			Client.AnimationTracks['Hold']:Play()
			Client.AnimationTracks['Patrol']:Stop()
			Client.Status.Patrolling = false
			if Client.Humanoid.MoveDirection ~= Vector3.new(0,0,0) and not Client.Status.Patrolling then
				Client.AnimationTracks['Walk']:Play(.2)
				Client.Status.isWalking = true
			end
		end
	end	
	
	--[[ RELOAD HANDLING ]]--
	function reloadWeapon()
		
		if (Client.Status.maxAmmunition - Client.firearmStats.MagCapacity) >= 0 then
			
			--[[ EXIT ZOOM ]]--
			if Client.Status.isZoomed or zoomToggle then
				zoomOut()
			end
			
			--[[ RENAMING ]]--
			Client.Status.Reloading = true
			local prevName = Client.Tool.Name
			Client.Tool.Name = '[REL]'
			
			--[[ CLIENT-SIDE MAGAZINE RENDERING ]]--
			newMagazine()
			
			--[[ RENAMING AND SETTING AMMO VALUE ]]--
			Client.Tool.Name = prevName
			Client.Status.maxAmmunition = Client.Status.maxAmmunition - Client.firearmStats.MagCapacity
			Client.Status.Ammunition = Client.firearmStats.MagCapacity
			if Client.GUI and Client.GUI:FindFirstChild('Ammo') then Client.GUI.Ammo.Text = Client.Status.Ammunition..'/'..Client.Status.maxAmmunition end
			
			--[[ PUTTING BOLT FORWARDS ]]--
			Client.Tool.BoltBack.Transparency = 1
			Client.Tool.Bolt.Transparency = 0
			if Client.Tool.Handle:FindFirstChild('Prime') then Client.Tool.Handle.Prime:Play() end
			wait(Client.firearmStats.Waittimes.ReloadConstant)
			Client.Status.Reloading = false
		end
			
	end
	
	--[[ FIRE HANDLING ]]--
	function fireWeapon()
		if not Client.Status.isShooting and Client.Status.isFireable and Client.Status.Ammunition > 0 and not Client.Status.Patrolling and Client.Status.Equipped and not Client.Status.Reloading and Client.Humanoid.Health > 0 then
			
			--[[ BOLT ACTION SCOPE CHECK ]]--
			if Client.Status.isBoltAction and Client.Status.isZoomed == false then return; end
			
			--[[ STATUS SET ]]--
			Client.Status.isShooting = true
			
			--[[ AMMUNITION HANDLING ]]--
			Client.Status.Ammunition = Client.Status.Ammunition - 1
			if Client.GUI and Client.GUI:FindFirstChild('Ammo') then Client.GUI.Ammo.Text = Client.Status.Ammunition..'/'..Client.Status.maxAmmunition end
			
			--[[ FIRE HANDLING ]]--
			local rayOrigin = Client.Tool:FindFirstChild('BarrelEnd')
			local directionUnit = (Client.Mouse.Hit.p - rayOrigin.Position).unit
			local trueAccuracy = (Client.Status.isZoomed and Client.Status.hasScope and (1-Client.firearmStats.Accuracy) * 100) or (Client.Status.hasScope and (1-(Client.firearmStats.Accuracy-0.01)) * 100) or ((1-Client.firearmStats.Accuracy) * 100)
			
			local accurateTarget = (Vector3.new(
				directionUnit.X + (math.random(-trueAccuracy,trueAccuracy) / 100),
				directionUnit.Y + (math.random(-trueAccuracy,trueAccuracy) / 100),
				directionUnit.Z + (math.random(-trueAccuracy,trueAccuracy) / 100)
			).unit) * Client.firearmStats.Range
			
			--[[ RAYCASTING ]]--
			local hitRay = Ray.new(rayOrigin.Position,accurateTarget)
			local hitpart, hitposition = workspace:FindPartOnRayWithIgnoreList(hitRay,Client.firearmStats.IgnoreList)
			
			--[[ CONFIRM HIT ]]--
			local confirmHit = Ray.new(Client.Character.Head.Position,(hitposition-Client.Character.Head.Position))
			local confirmHitpart, confirmhitPosition = workspace:FindPartOnRayWithIgnoreList(confirmHit,Client.firearmStats.IgnoreList)
			--
			local roundedOriginal = math.floor(confirmhitPosition.X)
			local roundedConfirmation = math.floor(hitposition.X)
			local confirmSight = (roundedOriginal == roundedConfirmation)
			
			if not confirmSight then
				hitposition,hitpart = confirmhitPosition,confirmHitpart
			end
			
			--[[ HITMARKER ]]--
			spawn(function()
				if hitpart and hitpart.Parent and hitpart.Parent:FindFirstChild('Humanoid') and Client.GUI and Client.GUI:FindFirstChild('Cursor') and Client.GUI:FindFirstChild('Reticle') then
					Client.GUI.Cursor.Image = Client.firearmStats['Cursors'][1].Hit
					Client.GUI.Reticle.Reticle.Image = Client.firearmStats['Reticles'][1].Hit
					wait(Client.firearmStats.Waittimes.HitmarkerTime)
					if Client.GUI and Client.GUI:FindFirstChild('Cursor') and Client.GUI:FindFirstChild('Reticle') then
						Client.GUI.Cursor.Image = Client.firearmStats['Cursors'][1].Normal
						Client.GUI.Reticle.Reticle.Image = Client.firearmStats['Reticles'][1].Normal
					end
				end
			end)
			
			--[[ SERVER DETECTION AND RENDER ]]--
			RE:FireServer('fireWeapon',Client.Character, hitpart, hitposition,(Client.Status.isBoltAction or false))
			
			--[[ CLIENT RENDER ]]--
			Client.Player:WaitForChild('PlayerScripts').Renderer.Render:Fire('renderTrail',Client.Tool.Flame.Attachment,hitposition)
			
			--[[ ROUND FIRED EFFECTS ]]--
			roundFired()
			
			wait(Client.firearmStats.Waittimes.FireConstant)
			Client.Status.isShooting = false
			return true
		elseif Client.Status.isFireable == false then
			return false
		elseif Client.Status.Ammunition <= 0 and Client.Status.isOnMobile and not Client.Status.Reloading and Client.Status.Equipped then
			if Client.Status.Patrolling then
				Client.AnimationTracks['Hold']:Play()
				Client.AnimationTracks['Patrol']:Stop()
				Client.Status.Patrolling = false
				if Client.Humanoid.MoveDirection ~= Vector3.new(0,0,0) and not Client.Status.Patrolling then
					Client.AnimationTracks['Walk']:Play(.2)
					Client.Status.isWalking = true
				end
				reloadWeapon()
			else
				reloadWeapon()
			end
		elseif Client.Status.Ammunition <= 0 or Client.Status.Reloading then
			Client.Tool.Handle.NoRound:Play()
			return false
		elseif Client.Status.Patrolling then
			Client.AnimationTracks['Hold']:Play()
			Client.AnimationTracks['Patrol']:Stop()
			Client.Status.Patrolling = false
			if Client.Humanoid.MoveDirection ~= Vector3.new(0,0,0) and not Client.Status.Patrolling then
				Client.AnimationTracks['Walk']:Play(.2)
				Client.Status.isWalking = true
			end
			wait(.3)
			return true
		else
			return false
		end
	end
	
	--[[ KEYBOARD INPUT HANDLING ]]--
	function handleKeyInput(input)
		local keyPressed = input.KeyCode
		if keyPressed == Client.Controls.Reload and not Client.Status.Reloading and Client.Status.Equipped then
			if Client.Status.Patrolling then
				Client.AnimationTracks['Hold']:Play()
				Client.AnimationTracks['Patrol']:Stop()
				Client.Status.Patrolling = false
				if Client.Humanoid.MoveDirection ~= Vector3.new(0,0,0) and not Client.Status.Patrolling then
					Client.AnimationTracks['Walk']:Play(.2)
					Client.Status.isWalking = true
				end
				reloadWeapon()
			else
				reloadWeapon()
			end
		elseif keyPressed == Client.Controls.Patrol and not Client.Status.Reloading and Client.Status.Equipped then
			lowerWeapon()
		elseif keyPressed == Client.Controls.ChangeFiremode and Client.Status.Equipped then
			if Client.Firingmode == 'AUTOMATIC' then Client.Firingmode = 'SEMI-AUTOMATIC' elseif Client.Status.canFullauto then Client.Firingmode = 'AUTOMATIC' end
			--
			if Client.GUI and Client.GUI:FindFirstChild('Mode') and Client.Firingmode == 'AUTOMATIC' then
				Client.GUI.Mode.Text = 'AUTO'
			elseif Client.GUI and Client.GUI.Mode then
				Client.GUI.Mode.Text = 'SEMI'
			end
		elseif keyPressed == Client.Controls.ChangeReticle then
			-- change reticle
		end
	end	
	
	--[[ FIRE INPUT REGISTERING ]]--
	Client.Tool.Activated:connect(function()
		Client.Status.mouseDown = true
		--
		if Client.Firingmode == 'AUTOMATIC' then
			while Client.Status.mouseDown do
				if not fireWeapon() then break end
			end			
		else
			fireWeapon()
		end
		if Client.Humanoid.MoveDirection ~= Vector3.new(0,0,0) and not Client.Status.Patrolling and Client.Status.Equipped and not Client.Status.isWalking then
			Client.AnimationTracks['Walk']:Play(.2)
			Client.Status.isWalking = true
		end
	end)
	Client.Tool.Deactivated:connect(function()
		Client.Status.mouseDown = false
	end)
	
	--[[ NON-FIRE INPUT REGISTERING ]]--
	local justClicked = false
	UserInputService.InputBegan:connect(function(input,gameProcessedEvent)
		if input.UserInputType == Enum.UserInputType.Keyboard and gameProcessedEvent == false then
			handleKeyInput(input)
		elseif not gameProcessedEvent and input.UserInputType == Enum.UserInputType.MouseButton2 and Client.Status.Equipped and not Client.Status.Patrolling and Client.Status.hasScope then
			
			--[[ DOUBLE CLICK TO ZOOM ]]--
			coroutine.resume(coroutine.create(function()
				if not justClicked then
					justClicked = true
					wait(1)
					if justClicked == true then
						justClicked = false
					end
				else
					justClicked = false
					toggleZoom()
				end
			end))
		end
	end)
	
	--[[ EQUIP HANDLING ]]--
	Client.Tool.Equipped:connect(function(newMouse)
		
		--[[ GUI SETUP ]]--
		if Client.Player.PlayerGui:FindFirstChild('firearmGUI') then Client.Player.PlayerGui.firearmGUI:Destroy() end
		spawn(function()
			Client.GUI = Modules.firearmGUI:Clone()
			Client.GUI.Parent = Client.Player.PlayerGui
			Client.GUI.RName.Text = Client.firearmStats['DisplayName']
			Client.GUI.Ammo.Text = Client.Status.Ammunition..'/'..Client.Status.maxAmmunition
			if not Client.Status.canFullauto then Client.Firingmode = 'SEMI-AUTOMATIC' end
			if Client.GUI and Client.GUI.Mode and Client.Firingmode == 'AUTOMATIC' then
				Client.GUI.Mode.Text = 'AUTO'
			elseif Client.GUI and Client.GUI.Mode then
				Client.GUI.Mode.Text = 'SEMI'
			end
			if Client.GUI:FindFirstChild('Reticle') then
				Client.GUI.Reticle.Reticle.Image = Client.firearmStats['Reticles'][1].Normal
			end
		end)
		
		--[[ EQUIP FUNCTION ]]--
		Client.AnimationTracks['Hold']:Play()
		bootFirearm()
		Client.Status.Equipped = true
		Client.Mouse = newMouse
		Client.Mouse.TargetFilter = Client.IgnoreModel
		
		--[[ ANIM FIX ]]--
		if Client.Humanoid.MoveDirection ~= Vector3.new(0,0,0) and not Client.Status.Patrolling then
			Client.AnimationTracks['Walk']:Play(.2)
			Client.Status.isWalking = true
		end
		
	end)
	Client.Tool.Unequipped:connect(function()
		
		--[[ UNEQUIP FUNCTION ]]--
		Client.Status.Equipped = false
		Client.Humanoid.WalkSpeed = 16
		Client.AnimationTracks['Hold']:Stop()
		Client.AnimationTracks['Patrol']:Stop()
		Client.AnimationTracks['Walk']:Stop()
		Client.AnimationTracks['Reload']:Stop()
		Client.Humanoid.AutoRotate = true
		Client.Status.Patrolling = false
		Client.Status.isShooting = false
		Client.Status.Reloading = false
		justClicked = false
		Client.GUI:Destroy()
		if Client.Status.isZoomed or zoomToggle then
			zoomOut()
		end
		
		--[[ DISCONNECT RUN-TIME FUNCTIONS ]]--
		for i,func in pairs(Client.FirearmFunctions) do
			func:disconnect()
		end
		Client.AnimationTracks['Walk']:Stop()
	end)
	
	return Client
