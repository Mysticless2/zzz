	--                                                           --
	--	 _______ ___ ___ _______ ______ _______ ______ _______   --
	--	|   _   |   |   |   _   |      |       |   __ \    ___|  --
	--	|       |   |   |       |   ---|   -   |      <    ___|  --
	--	|___|___|\_____/|___|___|______|_______|___|__|_______|  --
	--	                                                         --
	--                      by Avallex                           --
	
	local Server = {}
	 
	--[[ GAME SERVICES ]]--
	local Players = game:GetService('Players')
	local ReplicatedStorage = game:GetService('ReplicatedStorage')
	
	--[[ NETWORK ]]--
	local NetworkFolder = ReplicatedStorage:WaitForChild('firearmsNetwork')
	local RE,RF = NetworkFolder:WaitForChild('RE'),NetworkFolder:WaitForChild('RF')
	
	--[[ MODULE VARIABLES ]]--
	Server.Tool = script.Parent.Parent
	Server.Character = Server.Tool.Parent.Parent.Character
	Server.Player = Server.Tool.Parent.Parent
	Server.firearmStats = require(game:GetService('ReplicatedStorage'):WaitForChild('firearmsModules'):WaitForChild('firearmStats'))[Server.Tool.Name]
	Server.Equipped = false;
	
	--[[ CLONE HANDLING ]]--
	function createClone()
	
		local fakeClone = Instance.new('Model')
		fakeClone.Name = (Server.firearmStats.CloneName or 'firearmClone')
		
		local h = Server.Tool.Handle:Clone();h.Parent = fakeClone
		for i,part in pairs(Server.Tool:GetChildren()) do
			if part:IsA('BasePart') and part.Name ~= 'Handle' and part.Name ~= 'Mag' then
				for i,v in pairs(part:GetChildren()) do if v:IsA('Weld') then v:Destroy() end end
				part:Clone().Parent = fakeClone
			end
		end
		
		for i,part in pairs(fakeClone:GetChildren()) do
			if part:IsA('BasePart') and part.Name ~= 'Handle' then
				local w = Instance.new('Weld',part)
				w.Part0 = fakeClone.Handle
				w.Part1 = part
				w.C0 = fakeClone.Handle.CFrame:toObjectSpace(part.CFrame)
			end
		end
		
		local w = Instance.new('Weld',fakeClone.Handle)
		w.Part0 = fakeClone.Handle
		w.Part1 = Server.Character:FindFirstChild(Server.firearmStats.WeldPart or 'Torso')
		w.Name = 'cloneWeld'
		w.C0 = Server.firearmStats.WeldOffset
		--
		for i,v in pairs(fakeClone.Handle:GetChildren()) do
			if v:IsA('Sound') then v:Stop() wait(.03) v:Destroy() end
		end
		--
		fakeClone.BarrelEnd.Flash.Enabled = false
		fakeClone.BarrelEnd.FlashFX.Enabled = false
		fakeClone.BarrelEnd.Smoke.Enabled = false
		fakeClone.Handle.Name = 'OldToolMain'
		--
		if not Server.Equipped then
			
			--[[ REMOVE CLONE ]]--
			for i,v in pairs(Server.Character:GetChildren()) do
				if v.Name == Server.firearmStats.CloneName then
					v:Destroy()
				end
			end
			fakeClone.Parent = Server.Character
		else
			fakeClone:Destroy()
		end
	end
	
	--[[ EQUIP HANDLING ]]--
	Server.Tool.Equipped:connect(function()
		
		Server.Equipped = true
		
		--[[ UPDATE CHARACTER ]]--
		Server.Character = Server.Tool.Parent
		
		--[[ REMOVE CLONE ]]--
		for i,v in pairs(Server.Character:GetChildren()) do
			if v.Name == Server.firearmStats.CloneName then
				v:Destroy()
			end
		end
		
		--[[ UPDATE PLAYER ]]--
		Server.Player = Players:GetPlayerFromCharacter(Server.Character)
		
		--[[ PLAY SOUND ]]--
	    Server.Tool.Handle.Equip:Play()
	    if Server.firearmStats.followCursor then
		    Server.Character:WaitForChild('Humanoid').AutoRotate = false
		end
	end)
	Server.Tool.Unequipped:connect(function()
		Server.Equipped = false
		
		if Server.Character:FindFirstChild('Humanoid') and Server.Character:FindFirstChild('Humanoid').Health <= 0 then return; end
		Server.Character:WaitForChild('Humanoid').AutoRotate = true
		
		
		wait(.03)
		if not Server.Equipped then
			createClone()
		end
	end)
	
	
	return Server
