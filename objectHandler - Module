--[[
	Object Handler Module
	Handles damage to environmental objects like radio antennas
]]

local ObjectHandler = {}

-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Helper function to search up hierarchy for a specific model name
local function findAncestorByName(instance, nameToFind)
	if instance == workspace then return nil end
	
	local parent = instance.Parent
	if not parent then return nil end
	
	if parent.Name == nameToFind then
		return parent
	end
	
	return findAncestorByName(parent, nameToFind)
end

-- Detect if hit part belongs to a radio antenna
function ObjectHandler:detectAntennaHit(hitPart)
	if not hitPart or not hitPart.Parent or not hitPart.Parent:IsA("Model") then
		return nil
	end
	
	return findAncestorByName(hitPart, "RadioAntenna")
end

-- Handle damage to objects
function ObjectHandler:handleDamage(hitPart)
	if not hitPart then return end
	
	task.spawn(function()
		local antennaObject = self:detectAntennaHit(hitPart)
		if antennaObject then
			local stats = antennaObject:FindFirstChild("Stats")
			if stats then
				local health = stats:FindFirstChild("Health")
				if health then
					health.Value = health.Value - 1
				end
			end
		end
	end)
end

-- Setup repair event
local weldEvent = ReplicatedStorage:FindFirstChild("weldEvent")
if not weldEvent then
	weldEvent = Instance.new("RemoteEvent")
	weldEvent.Name = "weldEvent"
	weldEvent.Parent = ReplicatedStorage
end

weldEvent.OnServerEvent:Connect(function(player, antennaModel)
	if not antennaModel or not antennaModel:FindFirstChild("Stats") then return end
	
	local stats = antennaModel.Stats
	local health = stats:FindFirstChild("Health")
	if not health then return end
	
	-- Repair antenna over time
	for i = 1, 5 do
		task.wait(0.2)
		health.Value = health.Value + 1
	end
end)

return ObjectHandler
