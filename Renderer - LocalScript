--[[
	Renderer LocalScript
	Handles client-side visual effects for firearms (bullet trails, etc.)
]]

-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Debris = game:GetService("Debris")

-- Constants
local TRAIL_LIFETIME = 0.2
local TRAIL_WIDTH = 0.1
local TRAIL_TEXTURE = "rbxassetid://2057499323"
local TRAIL_COLOR = ColorSequence.new(Color3.fromRGB(255, 255, 0))

-- Get ignore model for parenting trail parts
local IgnoreModel = workspace:WaitForChild("IgnoreModel")

-- Command handlers
local CommandHandlers = {
	renderTrail = function(sourceAttachment, hitPosition)
		if not sourceAttachment or not hitPosition then return end
		
		-- Create anchor part at hit position
		local anchorPart = Instance.new("Part")
		anchorPart.Anchored = true
		anchorPart.CanCollide = false
		anchorPart.Transparency = 1
		anchorPart.Size = Vector3.new(0.1, 0.1, 0.1)
		anchorPart.Position = hitPosition
		
		-- Create attachment on anchor part
		local targetAttachment = Instance.new("Attachment")
		targetAttachment.Parent = anchorPart
		
		-- Create beam trail
		local trail = Instance.new("Beam")
		trail.Attachment0 = targetAttachment
		trail.Attachment1 = sourceAttachment
		trail.LightEmission = 1
		trail.Width0 = TRAIL_WIDTH
		trail.Width1 = TRAIL_WIDTH
		trail.Texture = TRAIL_TEXTURE
		trail.Color = TRAIL_COLOR
		trail.Segments = 1
		trail.TextureSpeed = -3
		trail.TextureMode = Enum.TextureMode.Stretch
		trail.FaceCamera = true
		trail.Parent = sourceAttachment
		
		-- Parent and cleanup
		anchorPart.Parent = IgnoreModel
		Debris:AddItem(anchorPart, TRAIL_LIFETIME)
		Debris:AddItem(trail, TRAIL_LIFETIME)
	end
}

-- Main render function
local function render(command, ...)
	local handler = CommandHandlers[command]
	if handler then
		handler(...)
	end
end

-- Network event listener
local NetworkFolder = ReplicatedStorage:WaitForChild("firearmsNetwork")
local RE = NetworkFolder:WaitForChild("RE")

RE.OnClientEvent:Connect(function(command, ...)
	render(command, ...)
end)

-- Local render event listener
local RenderEvent = script:WaitForChild("Render")
RenderEvent.Event:Connect(function(command, ...)
	render(command, ...)
end)
